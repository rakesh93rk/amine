<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Levi Interior - Attendance</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap');
:root {
  --primary:#2563eb;--accent:#06b6d4;--surface:#ffffff;
  --separator:#e2e8f0;--text-primary:#0f172a;--muted:#64748b;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'SF Pro Display',sans-serif;
  background:linear-gradient(180deg,#e0e7ff 0%,#fff 100%);
  color:var(--text-primary);
  min-height:100vh;
  display:flex;justify-content:center;align-items:center;
}
.app-container{
  width:100%;max-width:460px;background:var(--surface);
  border-radius:32px;box-shadow:0 8px 20px rgba(0,0,0,0.1);
  border:1px solid var(--separator);overflow:hidden;position:relative;
  padding:40px 20px;text-align:center;
}
.logo{
  width:120px;height:120px;border-radius:28px;object-fit:cover;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  padding:4px;margin-top:10px;
}
h1{
  font-size:30px;margin-top:20px;font-weight:700;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.card{
  border:1px solid var(--separator);
  background:linear-gradient(145deg,#f9f9ff,#edf2ff);
  border-radius:20px;padding:20px;
  box-shadow:0 4px 8px rgba(0,0,0,0.08);
  margin-top:20px;
}
.btn{
  width:100%;
  border-radius:20px;
  padding:18px;
  font-size:17px;
  font-weight:600;
  cursor:pointer;
  border:none;
  margin-top:12px;
}

/* EXTRA LIGHT COLORS */
.btn-in{
  background:#e8fdf2;
  color:#14532d;
  border:1px solid #bbf7d0;
}
.btn-out{
  background:#ffecec;
  color:#7f1d1d;
  border:1px solid #fecaca;
}

.preview{width:100%;margin-top:10px;border-radius:14px;display:none;}
.small{font-size:13px;color:var(--muted);margin-top:6px;}

.warning{
  display:none;
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  background:#fff7ed;
  color:#9a3412;
  font-size:14px;
  font-weight:600;
  border:1px solid #fed7aa;
}
</style>
</head>

<body>
<div class="app-container">

<img src="https://i.imgur.com/284Ol04.jpeg" class="logo">
<h1>Attendance</h1>

<div class="card">
  <button class="btn btn-in" onclick="checkIn()">üü¢ Check In</button>
  <button class="btn btn-out" onclick="checkOut()">üî¥ Check Out</button>
</div>

<div id="warningText" class="warning">‚ö†Ô∏è Upload your work photos</div>

<div class="card">
  <img id="selfiePreview" class="preview">
  <div id="locationText" class="small"></div>
  <div id="timeText" class="small"></div>
</div>

<script>
let checkInLat=null, checkInLng=null;

function checkIn(){
  document.getElementById("warningText").style.display="none";
  takeSelfie();
  getLocation(true);
}

function checkOut(){
  document.getElementById("warningText").style.display="block";
  takeWorkPhotos();
  getLocation(false);
}

// SELFIE (CHECKIN)
function takeSelfie(){
  const input=document.createElement("input");
  input.type="file";
  input.accept="image/*";
  input.capture="camera";
  input.onchange=e=>{
    const file=e.target.files[0];
    const reader=new FileReader();
    reader.onload=()=>{
      document.getElementById("selfiePreview").src=reader.result;
      document.getElementById("selfiePreview").style.display="block";
      const now=new Date();
      document.getElementById("timeText").innerText="Time: "+now.toLocaleString();
    }
    reader.readAsDataURL(file);
  }
  input.click();
}

// WORK PHOTOS (CHECKOUT) - CAMERA + MULTIPLE
function takeWorkPhotos(){
  const input=document.createElement("input");
  input.type="file";
  input.accept="image/*";
  input.capture="camera";
  input.multiple=true;
  input.click();
}

// LOCATION + AREA NAME
function getLocation(isCheckIn){
  if(!navigator.geolocation){
    alert("GPS not supported");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos=>{
    const lat=pos.coords.latitude;
    const lng=pos.coords.longitude;

    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
      .then(res=>res.json())
      .then(data=>{
        const address = data.display_name;

        document.getElementById("locationText").innerText =
          "Location: " + address;

        if(isCheckIn){
          localStorage.setItem("checkin_location",
            JSON.stringify({lat,lng,address}));
        }else{
          const saved=JSON.parse(localStorage.getItem("checkin_location"));
          if(saved){
            const dist=calcDistance(saved.lat,saved.lng,lat,lng);
            if(dist>0.2){
              alert("‚ö†Ô∏è You moved more than 200 meters from check-in location!");
            }
          }
        }
      })
      .catch(()=>{
        document.getElementById("locationText").innerText =
          "Location: "+lat+","+lng;
      });

  },()=>{
    alert("Location permission denied");
  });
}

// DISTANCE CALCULATION (KM)
function calcDistance(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)*Math.sin(dLat/2)+
          Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
          Math.sin(dLon/2)*Math.sin(dLon/2);
  const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  return R*c;
}
</script>

</body>
</html>
