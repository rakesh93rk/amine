<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Levi Interior - Attendance</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap');

body{
  font-family:'SF Pro Display',sans-serif;
  background:linear-gradient(180deg,#e0e7ff 0%,#fff 100%);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.app-container{
  width:100%;
  max-width:460px;
  background:white;
  border-radius:28px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
  padding:30px 20px;
  text-align:center;
}

.logo{
  width:100px;
  border-radius:20px;
  background:#2563eb;
  padding:4px;
}

h1{margin:15px 0;}

.card{
  background:#f9f9ff;
  padding:16px;
  border-radius:18px;
  margin-top:14px;
}

.btn{
  width:100%;
  padding:14px;
  border-radius:16px;
  border:none;
  font-weight:600;
  margin-top:10px;
  cursor:pointer;
}

.btn-in{background:#e8fdf2;color:#14532d;}
.btn-upload{background:#f1f5f9;color:#1e293b;}
.btn-final{background:#ef4444;color:white;display:none;}

.preview{width:100%;margin-top:10px;border-radius:12px;display:none;}
.work-previews img{width:100%;margin-top:8px;border-radius:12px;}
.small{font-size:13px;color:#555;margin-top:6px;}
.warning{display:none;background:#fee2e2;color:#7f1d1d;padding:10px;border-radius:12px;margin-top:10px;}
</style>
</head>

<body>
<div class="app-container">

<img src="https://i.imgur.com/284Ol04.jpeg" class="logo">
<h1>Attendance</h1>

<div class="card">
<button class="btn btn-in" onclick="checkIn()">ðŸŸ¢ Check In</button>
<button class="btn btn-upload" onclick="uploadWorkPhotos()">ðŸ“¸ Upload Work Photos</button>
<button class="btn btn-final" id="finalCheckoutBtn" onclick="finalCheckout()">ðŸ”´ Checkout</button>
</div>

<div class="card">
<img id="selfiePreview" class="preview">
<div id="workPreviewBox" class="work-previews"></div>
<div id="locationText" class="small"></div>
<div id="timeText" class="small"></div>
</div>

<script>
let checkInTime = null;
let checkOutTime = null;
let checkInAddress = "";
let checkOutAddress = "";
let workPhotosUploaded = false;

/* CHECK IN */
function checkIn(){
  takeSelfie();
  getLocation(true);
  checkInTime = new Date();
}

/* SELFIE */
function takeSelfie(){
  const input=document.createElement("input");
  input.type="file";
  input.accept="image/*";
  input.capture="camera";
  input.onchange=e=>{
    const reader=new FileReader();
    reader.onload=()=>{
      document.getElementById("selfiePreview").src=reader.result;
      document.getElementById("selfiePreview").style.display="block";
      document.getElementById("timeText").innerText="Check-in Time: "+new Date().toLocaleString();
    }
    reader.readAsDataURL(e.target.files[0]);
  }
  input.click();
}

/* UPLOAD WORK PHOTOS */
function uploadWorkPhotos(){
  const input=document.createElement("input");
  input.type="file";
  input.accept="image/*";
  input.capture="camera";
  input.multiple=true;
  input.onchange=e=>{
    const box=document.getElementById("workPreviewBox");
    box.innerHTML="";
    Array.from(e.target.files).forEach(f=>{
      const r=new FileReader();
      r.onload=()=>{
        const img=document.createElement("img");
        img.src=r.result;
        box.appendChild(img);
      }
      r.readAsDataURL(f);
    });

    workPhotosUploaded = true;
    document.getElementById("finalCheckoutBtn").style.display="block";
  }
  input.click();
}

/* FINAL CHECKOUT */
function finalCheckout(){
  if(!workPhotosUploaded){
    alert("Please upload work photos first");
    return;
  }
  getLocation(false);
}

/* LOCATION */
function getLocation(isCheckIn){
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat=pos.coords.latitude;
    const lng=pos.coords.longitude;

    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
    .then(r=>r.json())
    .then(d=>{
      document.getElementById("locationText").innerText="Location: "+d.display_name;

      if(isCheckIn){
        checkInAddress = d.display_name;
        alert("Check-in successful");
      }else{
        checkOutTime = new Date();
        checkOutAddress = d.display_name;

        const diffMs = checkOutTime - checkInTime;
        const hours = (diffMs/1000/60/60).toFixed(2);

        const dataForAdmin = {
          checkInTime: checkInTime.toLocaleString(),
          checkOutTime: checkOutTime.toLocaleString(),
          workingHours: hours,
          date: checkOutTime.toLocaleDateString(),
          checkInAddress: checkInAddress,
          checkOutAddress: checkOutAddress
        };

        console.log("SEND TO ADMIN PANEL:", dataForAdmin);
        alert("Checkout successful");

        // future API:
        // fetch("/save-attendance", {method:"POST", body:JSON.stringify(dataForAdmin)})
      }
    });
  });
}
</script>

</body>
</html>
