<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Levi Interior - Attendance</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap');
:root {
  --primary:#2563eb;--accent:#06b6d4;--surface:#ffffff;
  --separator:#e2e8f0;--text-primary:#0f172a;--muted:#64748b;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'SF Pro Display',sans-serif;
  background:linear-gradient(180deg,#e0e7ff 0%,#fff 100%);
  min-height:100vh;display:flex;justify-content:center;align-items:center;
}
.app-container{
  width:100%;max-width:460px;background:#fff;
  border-radius:32px;box-shadow:0 8px 20px rgba(0,0,0,.1);
  padding:40px 20px;text-align:center;
}
.logo{width:120px;border-radius:28px;background:linear-gradient(135deg,var(--primary),var(--accent));padding:4px;}
h1{margin:20px 0;font-size:28px;}
.card{background:#f9f9ff;padding:20px;border-radius:20px;margin-top:15px;}
.btn{width:100%;padding:16px;border-radius:18px;border:none;font-weight:600;margin-top:12px;}
.btn-in{background:#e8fdf2;color:#14532d;}
.btn-out{background:#ffecec;color:#7f1d1d;}
.small{font-size:13px;margin-top:8px;color:#555;}
.warning{display:none;background:#fee2e2;color:#7f1d1d;padding:10px;border-radius:12px;margin-top:10px;}
</style>
</head>

<body>
<div class="app-container">

<img src="https://i.imgur.com/284Ol04.jpeg" class="logo">
<h1>Attendance</h1>

<div class="card">
<button class="btn btn-in" onclick="checkIn()">Check In</button>
<button class="btn btn-out" onclick="checkOut()">Check Out</button>
</div>

<div id="warningText" class="warning"></div>

<div class="card">
<div id="locationText" class="small"></div>
<div id="timeText" class="small"></div>
</div>

<script>
function checkIn(){
  getLocation(true);
}

function checkOut(){
  getLocation(false);
}

function getLocation(isCheckIn){
  if(!navigator.geolocation){
    alert("GPS not supported");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos=>{
      const lat=pos.coords.latitude;
      const lng=pos.coords.longitude;

      const saved=JSON.parse(localStorage.getItem("checkin_location"));

      if(!isCheckIn && !saved){
        alert("Please check-in first");
        return;
      }

      let dist=0;
      if(!isCheckIn){
        dist=calcDistance(saved.lat,saved.lng,lat,lng);
      }

      if(!isCheckIn && dist>0.5){
        document.getElementById("warningText").style.display="block";
        document.getElementById("warningText").innerText=
        "You are not at work location. Ask admin to approve checkout.";
        return;
      }

      fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
      .then(res=>res.json())
      .then(data=>{
        document.getElementById("locationText").innerText="Location: "+data.display_name;
        document.getElementById("timeText").innerText="Time: "+new Date().toLocaleString();

        if(isCheckIn){
          localStorage.setItem("checkin_location",JSON.stringify({lat,lng}));
          alert("Check-in successful");
        }else{
          alert("Checkout successful");
        }
      })
      .catch(()=>{
        document.getElementById("locationText").innerText="Location: "+lat+","+lng;
      });
    },
    err=>{
      alert("Location error: "+err.message);
    }
  );
}

function calcDistance(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+
          Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
          Math.sin(dLon/2)**2;
  return R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
}
</script>

</body>
</html>
